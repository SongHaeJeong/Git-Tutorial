윈도우에 도커 설치하기(Docker Toolbox)

**※ 도커의 동작 과정 살펴보기 ※**



**docker ps**

=> 현재 돌아가고 있는 컨테이너를 확인하는 명령어입니다.

**docker images**

=> 현재 도커 머신에 설치된 도커 이미지를 확인하는 명령어입니다.

**docker run -a busybox echo 'Hello World'**

=> 먼저 로컬 서버에서 busybox라는 이미지를 찾습니다.

=> 로컬 서버에 해당 이미지가 없으면 도커 허브(Docker Hub)에서 자동으로 다운로드 받습니다.

=> 해당 이미지를 이용해 컨테이너를 실행합니다.

=> 컨테이너 실행 과정에서 디스크 및 메모리를 할당해서 순식간에 리눅스 서버를 구축합니다.

=> 새롭게 생성된 리눅스 서버에서 'Hello World'를 출력합니다.

=> 출력된 결과를 유닉스 소켓을 이용해 클라이언트로 전송하여 화면에 출력합니다.

 발표에서는 정말 쉽게 쉽게 명령어를 입력하고 있는 것처럼 보이지만, 내부적으로는 엄청난 일들이 일어나고 있는 겁니다!



**※ 도커 소프트웨어의 개요 ※**

 도커는 크게 ① 오픈소스 무료 버전(Community Edition), ② 유료 버전(Enterprise Edition)으로 나뉩니다.

 기본적으로 CE 버전으로도 도커의 모든 기능을 이용하는데 큰 제약이 없지만 안정적으로 실 서버에 도커를 운용하려면 EE를 사용하는 것이 훨씬 유리합니다. 기본적으로 도커 EE를 쓰면 각 서버별로 연간 1,000 달러 이내의 라이선스 비용이 소요됩니다. 다만 전반적인 배포 과정을 훨씬 편리하게 해주어 효용이 높습니다. 또한 현재는 기본적으로 도커 엔진 자체가 사실상 스웜(Swarm)이나 쿠버네티스(Kubernetes) 기술을 지원하고 있어서 유료 서비스만 잘 엮어서 쓰면 매우 강력한 기능을 쉽게 이용할 수 있습니다.

 **도커 엔진(Docker Engine)**: 특정한 소프트웨어를 도커 컨테이너로 만들고 실행하게 해주는 데몬(Daemon)을 의미합니다. 도커 엔진과 도커 클라이언트 사이에는 REST API가 사용됩니다. REST API 서버에 요청을 보내는 것이 도커 클라이언트입니다.

 **도커 클라이언트(Docker Client)**: 도커 엔진과 통신하는 소프트웨어로 개발자가 직접 이용할 수 있습니다. 윈도우(Window)/맥(Mac)/리눅스(Linux)를 지원합니다. 물론 윈도우는 도커를 사용하기에 최악의 조건이고, 리눅스가 제일 최상의 조건이지만 도커는 공식적으로 윈도우를 제대로 지원하고 있습니다.

 **도커 호스트 운영체제(Docker Host OS)**: 도커 엔진을 설치할 수 있는 운영체제 환경을 의미합니다. 64비트 리눅스 커널 버전 3.10 이상 환경을 의미하고, 32비트 환경에서는 도커 엔진이 돌아가지 않는답니다. 애초에 초기의 도커 이미지는 심지어 오직 우분투(Ubuntu) 운영체제 전용이었어요. 현재는 우분투, CentOS, Debian, Fedora 등에서 사용할 수 있게 되었지만요.

 추가적으로 언급하자면, **사실 윈도우는 Docker Host OS가 될 수 없습니다.** 당연한 거죠. 도커 엔진은 기본적으로 리눅스 OS 위에서 돌아가는거니까 가상화 기능이 필요합니다. 하지만 다행히도 마이크로소프트(Microsoft)는 기본적으로 도커(Docker)에 많은 관심을 가지고 있는 상황입니다. 그 결과 마이크로소프트는 도커의 초기 버전부터 많은 모듈을 덧붙여서 윈도우 파일 시스템과 도커의 파일 시스템이 연동될 수 있도록 모듈을 개발하여, 현재는 윈도우 컨테이너가 도커 명령어로 정상적으로 작동하고 리눅스 컨테이너와 상호 통신까지 가능합니다.

 **도커 머신(Docker Machine)**: 로컬 및 원격지 서버에 도커 엔진을 설치하고, 다양한 환경 설정을 자동으로 수행해주는 클라이언트를 의미합니다.



 우리가 이번 시간에 설치하게 될 도커 툴박스(Docker Toolbox)는 도커 CE의 이전 버전인데, 윈도우 10 Enterprise/Professional 이전 버전의 윈도우 사용자는 필수적으로 이러한 도커 툴박스를 이용해야 합니다. 물론 기능상으로 큰 문제는 없기 때문에 그냥 이용하시면 됩니다.



**▶ 도커 툴 박스 설치 사이트:** https://docs.docker.com/toolbox/toolbox_install_windows/



 위 사이트에 접속하면 기본적으로 윈도우 10 Enterprise/Professional은 툴박스가 아니라 윈도우 도커(Docker For Windows) 애플리케이션을 설치할 것을 권장하는 것을 알 수 있습니다. 하지만 **우리는 최신 버전의 도커 애플리케이션을 이용하지 않고, 툴박스를 이용**할 겁니다. 툴박스를 이용해도 기능적으로는 문제가 없습니다. 이용상의 장단점에 대해서는 차차 알아가시면 됩니다.

 

 우리가 설치할 도커 툴박스는 기본적으로 오라클 VM VirtualBox를 기반으로 동작합니다. 쉽게 말하면 **윈도우 위에 리눅스 가상 머신을 돌리고, 그 위에서 도커 엔진을 돌리는 방식**이라고 이해할 수 있습니다. 그래서 일단 기본적인 VM 가상화 기능을 사용할 수 있어야 합니다. 따라서 윈도우 운영체제에서 '작업 관리자'의 '성능' 탭에 들어갔을 때 가상화 기능이 활성화 되어있어야 합니다.



![img](https://t1.daumcdn.net/cfile/tistory/9998D4485B563B352F)



 위 사진은 제 컴퓨터의 '작업 관리자'입니다. 저는 윈도우 10 홈(Home) 버전을 쓰고 있어서 이렇게 나오는 건데요, 그냥 '가상화'가 '사용'이라고 되어 있는 것을 체크하시면 됩니다. VM 기능을 이용할 수 있는 상태이므로 바로 도커 툴박스 버전을 설치하면 되는 겁니다. 만약에 '가상화'가 비활성화 되어있으신 분은 노트북 혹은 데스크탑을 재부팅하셔서 바이오스(Bios)에 진입하여 '가상화' 기능을 활성화 해주시면 됩니다.

__주의인텔의 경우 VT라고 명칭을 찾으면 되는데 amd는 SVM mode 찾아서 활성화 해줘야됨__ 

Advanced(고급) > CPU 구성 > SVM Mode(가상화 설정) - 활성화 해주면 됩니다. 

이후 설치했는데 안되서  https://superuser.com/questions/1443294/docker-toolbox-doesnt-have-vt-x-amd-v-even-if-it-is-enabled 링크 보고 문제 해결 69번 줄에 create -d virtualbox --virtualbox-no-vtx-check 코드 추가해주면 됩니다.



![img](https://t1.daumcdn.net/cfile/tistory/9994AB485B563B352F)



 이제 바로 위와 같이 'Get Docker Toolbox for Windows'를 눌러서 툴박스 설치 프로그램을 다운로드 받아주세요!



**※ 툴박스를 설치하면 자동으로 설치되는 것들 ※**



\- 도커 엔진이 이미지 및 컨테이너를 생성할 수 있도록 해주는 **도커 클라이언트(Docker Client)**

\- 윈도우 터미널에서 사용하는 도커 엔진 명령어를 이용하게 해주는 **도커 머신(Docker Machine)**

\- **도커 컴포즈(Docker Compose)** 기능

\- 도커 GUI 도구인 **카이트메틱(Kitematic)**

\- 도커 명령어 입력이 가능한 **도커 빠른시작 터미널(Docker QuickStart Shell)**

\- **오라클 VM VirtualBox**



 말했듯이 윈도우에서는 기본적으로 도커 엔진을 구동시킬 수 없습니다. 그래서 작은 크기의 VM 리눅스 위에서 도커 머신 명령어를 입력하는 식으로 도커 엔진에 접근할 수 있습니다. 즉, VM이 도커 엔진의 호스트 역할을 수행하게 되는 겁니다. 그렇기 때문에 당연히 도커 툴박스 관리 도구 및 ISO 파일이 함께 설치됩니다. 이 ISO 파일이 오라클 VM VirtualBox 위에서 동작하는 것이라고 볼 수 있습니다.



![img](https://t1.daumcdn.net/cfile/tistory/99AE22415B563EFF31)



 도커 툴박스 설치 프로그램을 실행하면 위와 같습니다.



![img](https://t1.daumcdn.net/cfile/tistory/99B089415B563EFF32)



 설치 경로를 물어보는데 기본 경로로 넣으시면 됩니다. 나중에 이 경로가 도커 기본 터미널의 경로로 설정됩니다.



![img](https://t1.daumcdn.net/cfile/tistory/99A897415B563EFF32)



 이제 설치 구성 목록을 물어보는데, 전체 설치(Full Installation)으로 설정해주세요. 보시면 도커 컴포즈(Docker Compose) 및 VirtualBox와 Kitematic이 설치되는 것을 알 수 있습니다. 전부 위에서 언급했던 것들이에요. 추가적으로 추후에 도커 이미지 생성을 위한 각종 파일들은 모두 깃(Git)을 이용해서 관리하는 것이 일반적이므로 혹여나 깃이 설치되어있지 않으신 분들은 설치해주시는 것을 강력히 추천합니다.



![img](https://t1.daumcdn.net/cfile/tistory/99AFFB415B563EFF32)



 이후에 위와 같이 기본적인 환경설정 요소를 체크해주시고 넘어가시면 됩니다.





![img](https://t1.daumcdn.net/cfile/tistory/99B096415B563F0032)



 이제 설치를 진행합니다.



![img](https://t1.daumcdn.net/cfile/tistory/99A822415B563F0032)



 설치 완료 이후에는 다음과 같이 세 개의 아이콘이 바탕화면에 나타날 겁니다.



![img](https://t1.daumcdn.net/cfile/tistory/99870F4E5B564F2113)



**※ 도커의 기본 컨셉 ※**

 도커는 기본적으로 개발, 배포, 실행 단계를 지원하는 목적으로 사용됩니다. 애플리케이션을 배포할 때는 **컨테이너화(Containerization)**하여 배포하게 되는데, 말 그대로 특정한 애플리케이션을 컨테이너에 담아서 구동시키는 것을 의미합니다. 컨테이너가 가지는 다양한 특징들 때문에 '컨테이너화' 기술은 매우 각광받게 되었습니다.



\- 유동성(Flexible): 매우 복잡한 소프트웨어들이 컨테이너화 될 수 있습니다.

\- 가벼움(Lightweight): 컨테이너는 호스트 커널의 기능을 극대화하고 공유할 수 있습니다.

\- 상호변경성(Interchangable): 업데이트 및 업그레이드를 즉시 수행할 수 있습니다.

\- 이식성(Portable): 로컬에서 빌드하고, 클라우드에 배포하고, 어디에서나 실행할 수 있습니다.

\- 확장성(Scalable): 컨테이너의 복제품을 자동적으로 증가시키고 분배할 수 있습니다.

\- 수직성(Stackable): 다양한 서비스를 쌓아 올려 훌륭한 서비스를 만들 수 있습니다.



**※ 도커 기본 사용법 ※**



![img](https://user-images.githubusercontent.com/59730002/76308003-41547480-630d-11ea-915c-0149be3f378a.PNG)



 위 사진은 도커 실행 화면입니다.



![img](https://user-images.githubusercontent.com/59730002/76308044-57623500-630d-11ea-8d39-2916b731693e.png)



**docker --version** 명령어를 입력해서 설치된 도커의 버전을 확인할 수 있습니다.

**docker info** 명령어를 입력해서 설치된 도커의 버전을 보다 상세하게 확인할 수 있습니다.

**docker run hello-world**: 도커에서 헬로우 월드(Hello World)를 띄우는 명령어입니다. 우리 눈에는 보이지 않지만 다음의 과정이 포함되는 겁니다.



1) hello-world라는 이미지를 검색한다.

2) 로컬에 이미지가 있으면 쓰고, 없으면 도커 허브(Docker Hub)에서 내려받는다.

3) 해당 이미지를 컨테이너로 동작시킨다.



 결과적으로 위 화면과 같이 Hello World가 성공적으로 출력되었습니다.

![img](https://user-images.githubusercontent.com/59730002/76308143-81b3f280-630d-11ea-8f0f-e2c2bd7fabd2.png)



**docker images**: 현재 도커 머신에 존재하는 이미지 목록을 출력합니다.

**docker ps -a**: 현재 도커 머신에 존재하는 컨테이너를 출력합니다.



